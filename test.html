<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GAS 接続テスト</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", "Noto Sans JP", sans-serif; padding: 16px; }
    h1 { margin: 0 0 12px; }
    pre { background: #f6f8fa; padding: 12px; border-radius: 8px; overflow: auto; }
    .muted { color: #666; font-size: 12px; }
    .ok { color: #0a7; font-weight: 700; }
    .ng { color: #c00; font-weight: 700; }
  </style>
</head>
<body>

<h1>GitHub → GAS テスト</h1>
<div class="muted">※ GET で叩いて CORS（プリフライト）を回避します</div>

<script>
  // ★新しいデプロイURL（/exec）
  const GAS_EXEC = "https://script.google.com/macros/s/AKfycbzd5Vge6C_jaNrYV0ZegeQuhXPSQNr27sb4NtmfTDvocJ8T7qmBqE43YKsNBXQ8Dj2mEg/exec";

  // テスト入力
  const distanceKm = 10;
  const minutes = 30;

  // キャッシュ回避も込みでURL生成
  const url =
    GAS_EXEC
    + "?action=calc"
    + "&distanceKm=" + encodeURIComponent(distanceKm)
    + "&minutes=" + encodeURIComponent(minutes)
    + "&_ts=" + Date.now();

  document.body.insertAdjacentHTML("beforeend", `<pre>REQUEST URL:\n${url}</pre>`);

  fetch(url)
    .then(r => r.json())
    .then(d => {
      const isOk = (d && d.ok === true) || (d && d.isOk === true);
      document.body.insertAdjacentHTML(
        "beforeend",
        `<div class="${isOk ? 'ok' : 'ng'}">${isOk ? 'OK' : 'NG'}</div>` +
        `<pre>RESPONSE JSON:\n${JSON.stringify(d, null, 2)}</pre>`
      );
    })
    .catch(err => {
      document.body.insertAdjacentHTML(
        "beforeend",
        `<div class="ng">FETCH ERROR</div><pre>${String(err)}</pre>`
      );
    });
</script>

</body>
</html>
